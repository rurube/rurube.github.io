---
title: [살.머.파]1.머신러닝 파이프라인
tags: 
  - [tfx]
category:
  - TFX
date: 2023-08-26
---



## 1. 머신러닝 파이프라인의 필요성

- 머신러닝 파이프라인의 이점
  - 기존 모델 유지보수에서 벗어나 **새 모델에 집중**
  - 버그 예방
  - 버전 관리 문서화
  - 표준화
  - 주요 영향
    - 새로운 모델 개발 시간 확보
    - 기존 모델을 더 간단한 프로세스로 업데이트
    - 모델 재현에 소요되는 시간 단축
- 자동화된 머신러닝 파이프라인
  - 데이터셋, 학습된 모델에서 잠재적인 편향 감지
  - EU의 GDPR과 같은 데이터 보호법과 관련한 질문이 있을 때 도움이 되는 문서 추척을 만듦
  - 데이터 과학자의 개발 시간 확보, 업무 만족도 상향



## 2. 머신러닝 파이프라인을 고려해야 할 시기

- 파이프라인이 유용한 경우
  - 모델에 사용자가 있음
  - 지속적 업데이트와 세부 조정 필요
- 파이프라인이 유용하지 않은 경우
  - 단순히 새로운 모델을 실험
  - 새로운 모델 아키텍처 조사
  - 최신 논문 재현



## 3. 머신러닝 파이프라인 단계

- 새로운 학습 데이터 수집~새로 학습된 모델이 어떻게 작동하는지에 관한 피드백 받기
  - 피드백 -> 프로덕션 성능 지표, 제품 사용자 피드백
- 모델 생애 주기
  - 데이터 수집/버전 관리 -> 데이터 검증 -> 데이터 전처리 -> 모델 학습(+모델 튜닝) -> 모델 분석 -> 모델 검증 -> 모델 배포 -> 모델 피드백 -> 데이터 수집/버전 관리 -> ... (반복)
  - 데이터 수집과 데이터 버전 관리
    - 이어지는 이후 컴포넌트가 소화할 수 있는 형식으로 데이터 처리
    - 피처 엔지니어링 수행하지 않음
    - 데이터 버전 관리
  - 데이터 검증
    - 데이터 통계가 예상대로인지 확인
    - 데이터 드리프트가 감지되면,
      - 개별 클래스 샘플링 변경
      - 모델의 손실 함수 변경
  - 데이터 전처리
    - 레이블을 원-핫 또는 멀티-핫 벡터 등으로 변환
    - 텍스트의 문자를 인덱스로 변경하거나 텍스트 토큰을 단어 벡터로 변환
  - 모델 학습과 튜닝
    - 가능한 한 작은 오차를 만드는 모델 학습
  - 모델 분석
    - 일반적으로 정확도나 손실을 사용하여 최적의 모델 파라미터 집합을 결정
    - (최종 버전 결정 이후) 심층적인 모델 분석
      - 정밀도, 리콜, AUC 등의 다른 지표
      - 학습 검증 집합보다 더 큰 데이터셋에서 성능 계산
  - 모델 버전 관리
    - 다음 버전으로 어떤 `모델`, `하이퍼파라미터 세트`, `데이터셋`이 선택되었는지 추적
  - 모델 배포
    - 최신 모델 서버를 사용하면 웹 서버 프로그램 코드 작성 없이 모델 배포 가능
    - REST, RPC 등
    - 여러 버전을 동시에 호스팅하면 모델 개선 사항에 관한 피드백 획득 가능
    - 재배포로 인한 다운타임 감소
  - 피드백 루프
    - 피드백 루프를 이용하여 새로 배포된 모델의 효과와 성능 측정
  - 개인 정보 보호
    - 차등 개인 정보 보호
      - 수학 연산을 활용해 모델 예측이 사용자의 데이터를 노출하지 않도록 보장
    - 연합 학습
      - 원시 데이터가 사용자의 장치로부터 다른 곳으로 이전되지 않도록 함
    - 암호화된 머신러닝
      - 전체 학습 프로세스를 암호화된 공간에서 실행하거나 원시 데이터에서 훈련된 모델 암호화



## 4. 파이프라인 오케스트레이션

- 앞에서 설명한 머신러닝 파이프라인의 모든 컴포넌트를 실행하거나, 컴포넌트가 올바른 순서로 실행되도록 조정해야 함
  - 아파치 빔, 아파치 에어플로, 쿠버네티스, 인프라용 쿠브플로 파이프라인 등
- 개별 프로세스 산출물 저장
  - 텐서플로 ML 메타데이터스토어 등의 파이프라인 아티팩트 저장소
- 파이프라인 오케스트레이션의 필요성
  - 머신러닝 프로젝트 실패의 주요 원인 -> 머신러닝 파이프라인 내부의 커스텀 코드
    - 커스텀 코드는 한 프로젝트에서 다음 프로젝트로 쉽게 연결되지 않음
  - 표준화된 머신러닝 파이프라인을 채택하지 않으면 생기는 문제
    - 프로젝트별로 각기 다른 설정
    - 제멋대로인 로그 파일 위치
    - 개인 취향에 맞춘 디버깅 방법
- 방향 비순환 그래프(DAG)
  - 모든 의존성이 완전히 계산되지 않은 상태에서 일부 작업이 시작되지 않도록 한다